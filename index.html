<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Insurance Analytics Dashboard</title>
    <script>
        // Detect base path for GitHub Pages compatibility
        (function() {
            const path = window.location.pathname;
            let basePath = '';
            if (path !== '/' && path !== '/index.html' && window.location.protocol !== 'file:') {
                basePath = path.split('/').slice(0, -1).join('/');
            }
            document.write('<link rel="stylesheet" href="' + (basePath ? basePath + '/' : '') + 'css/style.css">');
        })();
    </script>
    <noscript><link rel="stylesheet" href="css/style.css"></noscript>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
</head>
<body>
    <div class="container">
        <main>
            <!-- Controls bar -->
            <section class="card controls-section">
                <div class="control-group">
                    <label for="class-select">Line of Business</label>
                    <div class="select-wrapper">
                        <select id="class-select"></select>
                        <svg class="select-arrow" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"/>
                        </svg>
                    </div>
                </div>
                <div class="control-group">
                    <label for="method-select">Ultimate Method</label>
                    <div class="select-wrapper">
                        <select id="method-select"></select>
                        <svg class="select-arrow" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"/>
                        </svg>
                    </div>
                </div>
                <div class="control-divider"></div>
                <div class="control-group slider-group">
                    <label for="quality-slider">Min Proj Quality</label>
                    <div class="slider-wrapper">
                        <input type="range" id="quality-slider" min="0" max="100" value="0" step="1">
                        <span class="slider-value" id="quality-value">0%</span>
                    </div>
                    <span class="methods-badge" id="methods-count" title="Methods passing filter">27 / 27</span>
                </div>
                <div class="controls-spacer"></div>
                <button class="methodology-btn" id="methodology-btn" title="Methodology">
                    <svg viewBox="0 0 20 20" fill="currentColor" width="18" height="18"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z" clip-rule="evenodd"/></svg>
                </button>
            </section>

            <!-- Methodology overlay -->
            <div class="methodology-overlay" id="methodology-overlay">
                <div class="methodology-panel">
                    <div class="methodology-header">
                        <h2>Methodology</h2>
                        <button class="methodology-close" id="methodology-close">&times;</button>
                    </div>
                    <div class="methodology-body">
                        <h3>Roll-Forward Framework</h3>
                        <p>We consider all combinations of pegged, unpegged, and fixed roll-forward approaches based on the previous assumptions set by the user. This allows them to better understand which roll-forward approach to adopt, given that these are the best possible feasible initial updates they can make to each reserving class. This is a better approach than considering all possible combinations, given that at this point the user knows which combinations of assumptions are sensible versus which ones are not, as well as which ones are more likely to be updated — people typically don't do a complete reserve review from scratch on roll-forward unless they explicitly ask for a deep dive.</p>

                        <h3>Projection Quality</h3>
                        <p>We assess projection quality based on a backtesting framework using the previous exercise time point as the backtester. Rather than always looking back one year or two years, we look back the number of periods that the roll-forward covers when assessing projection quality. This will need further development to test projection quality when different combinations of assumptions are used that haven't been implemented previously — for example, if a tail is implemented, or an IBNER-standing or Cape Cod method is used which is not currently introduced in the roll-forward framework.</p>

                        <h3>Reserve Deterioration</h3>
                        <p>We produce a reserve deterioration score based on the previous ultimate selected, which updates as new ultimates are considered — because the ultimate using the incurred-to-ultimate chart also updates. The metrics that feed into the reserve deterioration algorithm are based on the roll-forward time horizon: we look at incurred as a percentage of incurred at year X, where year X is the previous exercise date, rather than always looking at year one or year two. This helps us understand how different classes have moved.</p>

                        <p>This gives us an <strong>actual-versus-expected over expected</strong>, a <strong>percentage change in ultimate</strong>, a <strong>reserve deterioration score</strong>, and a <strong>projection quality score</strong>. This is a useful starting point: if actual-versus-expected is greater than X% or reserve deterioration is greater than Y%, then we should be reviewing this class — otherwise we can confirm we are satisfied. As a starting point, the initial roll-forward approach adopted will be the one that minimises the ultimate whilst keeping the reserve deterioration score below a certain threshold. This means we can increase ultimate efficiency without going too far; there is a world where you could increase the ultimate by a large amount which would reduce the deterioration score but would not be sensible from a business perspective. So this is a sensible objective function.</p>

                        <h3>Decision DAG</h3>
                        <p>We then apply an initial rules-based decision DAG. Based on all the information compiled, what is the most sensible action? If A-versus-E is positive and above 5%, and ultimates have not moved in line, we may need to increase the ultimate — particularly if the reserve deterioration score is above the threshold. The way we approach this is:</p>
                        <ul>
                            <li>If the reserve deterioration score is high because there is a fanning-out in incurred percentages (incurred as % of year one, and incurred-to-ultimate), this suggests incurred development has been greater than expected but ultimates have not moved in line. We first check if there is a speeding-up in the incurred pattern. If so, there is evidence of faster current development and perhaps ultimates do not need to increase — the deterioration score was flagging the <em>potential</em> for them to be weak.</li>
                            <li>If instead there is a slowing-down, then the worsening experience is not caused by a speeding-up trend. We may need to slow down the pattern, which would increase ultimates.</li>
                            <li>If neither applies, perhaps we are using a premium-based approach and need to shift towards a claims-development approach.</li>
                            <li>Perhaps the claims experience is driven by large losses rather than attritional claims — in which case we may need to treat some large claims separately or update inflation assumptions.</li>
                        </ul>
                        <p>This rules-based DAG can be revised over time based on our own reserving knowledge and experience, and serves as a starting point for suggested improvements which we can build into an automated framework.</p>
                    </div>
                </div>
            </div>

            <!-- Selected method strip + SHAP contributions side by side -->
            <div class="method-shap-row">
                <section class="card selected-method-strip" id="selected-method-strip">
                    <div class="table-wrapper">
                        <table id="strip-table" class="strip-table">
                            <thead>
                                <tr>
                                    <th>Method</th>
                                    <th>Pattern</th>
                                    <th>IE</th>
                                    <th>Approach</th>
                                    <th>Ultimate</th>
                                    <th>A-E / E</th>
                                    <th>% Δ Ults</th>
                                    <th>Reserve Det</th>
                                    <th>Prev Res Det</th>
                                    <th>Proj Quality</th>
                                </tr>
                            </thead>
                            <tbody id="strip-tbody"></tbody>
                        </table>
                    </div>
                </section>
                <section class="card shap-section" id="shap-section">
                    <div class="shap-header">
                        <h2 id="shap-title">Reserve Det. — Feature Contributions</h2>
                        <span class="shap-score" id="shap-score"></span>
                    </div>
                    <div class="shap-bar-container" id="shap-bar-container"></div>
                </section>
            </div>

            <!-- Charts grid — two columns -->
            <div class="charts-grid">
                <!-- Left column: Flight Path / A vs E + Reserving Decisions -->
                <div class="lhs-stack">
                    <section class="card chart-section">
                        <div class="chart-header">
                            <div>
                                <h2 id="chart-title">A vs E Flight Path Chart</h2>
                                <p class="chart-description" id="chart-desc">Actual vs Expected to Ultimate by Cohort</p>
                            </div>
                            <div class="view-toggle" id="view-toggle">
                                <button class="toggle-btn active" data-view="flight-path">Flight Path</button>
                                <button class="toggle-btn" data-view="comparison">A vs E</button>
                            </div>
                        </div>
                        <div id="flight-path-chart" class="chart-container"></div>
                    </section>

                    <section class="card decision-table-section" id="decision-table-section">
                        <div class="decision-table-header">
                            <h3 class="decision-table-title" id="decision-table-title">Reserving Decisions</h3>
                            <button class="dec-extra-toggle" id="dec-extra-toggle" title="Show / hide additional columns">
                                <svg viewBox="0 0 20 20" fill="currentColor" width="14" height="14"><path d="M10 3a1.5 1.5 0 110 3 1.5 1.5 0 010-3zm0 5.5a1.5 1.5 0 110 3 1.5 1.5 0 010-3zm0 5.5a1.5 1.5 0 110 3 1.5 1.5 0 010-3z"/></svg>
                                <span id="dec-extra-toggle-label">Less</span>
                            </button>
                        </div>
                        <div class="decision-table-wrapper">
                            <table id="decision-table" class="decision-table">
                                <thead>
                                    <tr>
                                        <th>Cohort</th>
                                        <th>A-E / E</th>
                                        <th>% Change Ults</th>
                                        <th>Res Det</th>
                                        <th>PQ</th>
                                        <th>In FO Trend</th>
                                        <th>Method</th>
                                        <th class="dec-extra-col">Pat Avg</th>
                                        <th class="dec-extra-col">Tail</th>
                                        <th class="dec-extra-col">IE Appr</th>
                                        <th class="dec-extra-col">Excl</th>
                                        <th class="dec-extra-col">SC Ack</th>
                                        <th>Driver</th>
                                        <th>Suggestion</th>
                                    </tr>
                                </thead>
                                <tbody id="decision-tbody"></tbody>
                            </table>
                        </div>
                    </section>
                </div>

                <!-- Right: switchable panel (dev charts ↔ claims) -->
                <div class="rhs-panel">
                    <div class="rhs-panel-nav">
                        <button class="rhs-nav-btn active" data-panel="charts" id="rhs-nav-charts">
                            <span class="rhs-nav-label">Development Charts</span>
                            <svg class="rhs-nav-arrow" viewBox="0 0 20 20" fill="currentColor" width="14" height="14"><path d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z"/></svg>
                        </button>
                        <button class="rhs-nav-btn" data-panel="claims" id="rhs-nav-claims">
                            <span class="rhs-nav-label">Claim Movements</span>
                            <svg class="rhs-nav-arrow" viewBox="0 0 20 20" fill="currentColor" width="14" height="14"><path d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z"/></svg>
                        </button>
                    </div>

                    <!-- Panel A: stacked dev charts -->
                    <div class="rhs-panel-view active" id="rhs-view-charts">
                        <div class="rhs-stack">
                            <section class="card chart-section">
                                <div class="chart-header">
                                    <h2 id="pct-chart-title">Incurred % of Ultimate</h2>
                                    <p class="chart-description">Cumulative incurred as percentage of selected ultimate</p>
                                </div>
                                <div id="pct-ultimate-chart" class="chart-container chart-container-half"></div>
                            </section>
                            <section class="card chart-section">
                                <div class="chart-header">
                                    <h2 id="norm-chart-title">Incurred / Year 1 (%)</h2>
                                    <p class="chart-description">Development normalised to first period — highlights trend presence</p>
                                </div>
                                <div id="norm-chart" class="chart-container chart-container-half"></div>
                            </section>
                        </div>
                    </div>

                    <!-- Panel B: claims table -->
                    <div class="rhs-panel-view" id="rhs-view-claims">
                        <section class="card claims-section">
                            <div class="claims-section-inner">
                                <div class="chart-header">
                                    <div>
                                        <h2 id="claims-title">Claim Movements</h2>
                                        <p class="chart-description" id="claims-desc">Click a cohort on the chart or a row in Reserving Decisions to drill down</p>
                                    </div>
                                    <button class="toggle-btn claims-clear-btn" id="claims-clear-btn" style="display:none">Show All</button>
                                </div>
                                <div class="claims-attribution" id="claims-attribution"></div>
                                <div class="claims-table-wrapper">
                                    <table id="claims-table">
                                        <thead>
                                            <tr>
                                                <th class="claims-sortable" data-sort="Cohort">Cohort <span class="sort-arrow"></span></th>
                                                <th>Claim</th>
                                                <th>Entity</th>
                                                <th>Status</th>
                                                <th class="claims-sortable" data-sort="Incurred_Current">Current <span class="sort-arrow"></span></th>
                                                <th class="claims-sortable" data-sort="Incurred_Prior">Prior <span class="sort-arrow"></span></th>
                                                <th class="claims-sortable" data-sort="Movement">Movement <span class="sort-arrow"></span></th>
                                            </tr>
                                        </thead>
                                        <tbody id="claims-tbody"></tbody>
                                    </table>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>

            <!-- Method scores table + distribution charts -->
            <div class="table-grid">
                <section class="card table-section">
                    <div class="table-section-inner">
                        <div class="chart-header">
                            <h2 id="table-title">Method Comparison</h2>
                            <p class="chart-description">Reserve Determination &amp; Projection Quality by method — click a row to select</p>
                        </div>
                        <div class="table-wrapper">
                            <table id="scores-table">
                                <thead>
                                    <tr>
                                        <th>Method</th>
                                        <th>Pattern</th>
                                        <th>IE</th>
                                        <th>Approach</th>
                                        <th class="sortable" data-sort="Ultimate">Ultimate <span class="sort-arrow"></span></th>
                                        <th>A-E / E</th>
                                        <th>% Δ Ults</th>
                                        <th class="sortable" data-sort="Reserve_Det">Reserve Det <span class="sort-arrow"></span></th>
                                        <th class="sortable" data-sort="Prior_Reserve_Det">Prev Res Det <span class="sort-arrow"></span></th>
                                        <th class="sortable" data-sort="Proj_Quality">Proj Quality <span class="sort-arrow"></span></th>
                                    </tr>
                                </thead>
                                <tbody id="scores-tbody"></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Score distributions -->
                <div class="dist-stack">
                    <section class="card chart-section dist-chart-section">
                        <h3 class="dist-title">Reserve Det Distribution</h3>
                        <div id="res-det-dist" class="dist-container"></div>
                    </section>
                    <section class="card chart-section dist-chart-section">
                        <h3 class="dist-title">Proj Quality Distribution</h3>
                        <div id="proj-qual-dist" class="dist-container"></div>
                    </section>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Detect base path and load dashboard.js
        (function() {
            const path = window.location.pathname;
            let basePath = '';
            if (path !== '/' && path !== '/index.html' && window.location.protocol !== 'file:') {
                basePath = path.split('/').slice(0, -1).join('/');
            }
            const script = document.createElement('script');
            script.src = (basePath ? basePath + '/' : '') + 'js/dashboard.js';
            document.body.appendChild(script);
        })();
    </script>
</body>
</html>
